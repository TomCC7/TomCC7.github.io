---
title: Linux notes
categories: notes
layout: post
---



# linux笔记

[toc]

## 系统

### 换源

```bash
sudo nano /etc/apt/sources.list #编辑sources.list
#官方指导: https://developer.aliyun.com/mirror/ubuntu
#粘帖以下
deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse
```



### 硬盘挂载

```bash
ls -lh /dev/disk/by-uuid #查看硬盘uuid
sudo vim /etc/fstab #修改启动文件
UUID=... /mnt/share ntfs-3g rw,uid=...,gid=...,umask=0000,locale=zh_CN.utf8,defaults 0 0
```

### 获取gid和uid

```bash
id -u username #uid
id -g username #gid
```

### 添加Windows字体

```bash
sudo cp -r #字体文件夹# /usr/share/fonts/WinFonts #复制文件夹
sudo chmod -R 755 /usr/share/fonts/WinFonts #设置权限
fc-cache #生成缓存
```



### 系统键盘禁用

```bash
xinput #查看输入设备
xinput set-prop (键盘序号) "Device Enabled" 0
```



### 连接vpn

```bash
sudo apt install strongswan network-manager-strongswan libcharon-extra-plugins
sudo vim /etc/ipsec.conf #编辑conf文件

### 将jAccount替换为自己的jaccount ###
# ipsec.conf - strongSwan IPsec configuration file

# basic configuration

config setup
	# strictcrlpolicy=yes
	# uniqueids = no

# Add connections here.

conn sjtu
	left=%config
	leftsourceip=%config
	leftauth=eap-gtc
	right=stu.vpn.sjtu.edu.cn
	rightsubnet=0.0.0.0/0
	rightid=@stu.vpn.sjtu.edu.cn
	rightauth=pubkey
	eap_identity=jAccount
	auto=add
##################
sudo vim /etc/ipsec.secrets #编辑密码文件
#####
jAccount : EAP "Your Password"
#####
sudo cp -r /etc/ssl/certs/* /etc/ipsec.d/cacerts #拷贝证书
sudo ipsec start #开启vpn服务
sudo ipsec up sjtu #连接sjtu vpn
sudo dpkg-reconfigure resolvconf # 解决pop-os无法连接dns服务器的bug，，，
```

### Setting proxy

> https://yechengfu.com/blog/2015/01/16/use-git-behind-proxy/

```bash
function vpn() {
  HTTP_PROXY=http://127.0.0.1:8889
  if [[ $1 != "off" ]];
  then
  export http_proxy=$HTTP_PROXY
  export https_proxy=$HTTP_PROXY
  export all_proxy=$HTTP_PROXY
  # only for 'github.com'
  git config --global http.https://github.com.proxy $HTTP_PROXY
  # use 'connect' with HTTP_PROXY environment
  export GIT_SSH_COMMAND='ssh -o ProxyCommand="nc -X connect -x 127.0.0.1:8889 %h %p"'
  git config --global core.gitproxy "/usr/bin/gitproxy for github.com"
  # echo
  echo vpn started!
  else
  unset http_proxy
  unset https_proxy
  unset all_proxy
  unset GIT_SSH_COMMAND
  git config --global --unset core.gitproxy
  echo vpn off
  fi
}
```

`\usr\bin\gitproxy`

````bash
#!/bin/sh
#
# Proxy wrapper for git protocol (9418).
#
# git config --global core.gitproxy "ido gitproxy"
#
exec /usr/bin/nc -X 5 -x <socks_host>:<socks_port> $1 $2
````



### 问题排查

#### 不小心删了bash

```bash
sudo ln -s /bin/sh /bin/bash
sudo apt install --reinstall bash
```



## 软件安装

### ZSH

#### 安装 oh-my-zsh

```bash
sudo apt install zsh
sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
sudo usermod -s /bin/zsh username #设置默认shell
```

#### 插件

- zsh-syntax-highlighting: https://github.com/zsh-users/zsh-syntax-highlighting

  ```bash
  git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting
  ```

- git-open: https://github.com/paulirish/git-open
- zsh-autosuggestions: https://github.com/zsh-users/zsh-autosuggestions

```bash
git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
```

- extract
- rand-quote
- themes
- gitignore
- cp
- zsh_reload

### PHP

```bash
##安装php##
sudo apt install software-properties-common
sudo add-apt-repository ppa:ondrej/php #添加库
sudo apt update #顺便再检查下更新
sudo apt install php7.4...

##安装composer##
#下载composer installer
php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
#检查哈希值
php -r "if (hash_file('sha384', 'composer-setup.php') === 'e0012edf3e80b6978849f5eff0d4b4e4c79ff1609dd1e613307e16318854d24ae64f26d17af3ef0bf7cfb710ca74755a') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;"
#安装于/usr/local/bin
sudo php composer-setup.php --install-dir=/usr/local/bin --filename=composer
#换国内镜像
composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/ 
```

### Mariadb

```bash
sudo apt install mariadb-server mariadb-client #安装
sudo mysql_secure_installation #设置密码
```

#### ERROR 1698 (28000): Access denied for user 'root'@'localhost'

```bash
sudo mysql -u root

USE mysql;
UPDATE user SET plugin='mysql_native_password' WHERE User='root';
FLUSH PRIVILEGES;
exit;

service mysql restart
```

#### 一些操作

```mysql
USE ...; #选择数据库
SELECT * FROM ...; #选择表
CREATE DATABASE ...; #创建数据库
CREATE TABLE ...; #创建表
DROP TABLE ...; #丢弃表
DROP DATABASE ...; #丢弃数据库
GRANT ALL ON ... .* TO ... ; #数据库授权
SOURCE .... ;#导入文件
```



### Deepin-Wine TIM,QQ

```bash
git clone https://gitee.com/wszqkzqk/deepin-wine-for-ubuntu.git #下载项目
cd deepin-wine-for-ubuntu #进入目录
bash ./install.sh #运行安装
```

### Anaconda

```bash
cd Downloads
wget https://repo.anaconda.com/archive/Anaconda3-2019.10-Linux-x86_64.sh
./Anaconda3-2019.10-Linux-x86_64.sh
```

#### 解决zsh显示（base）的问题

```bash
vim ~/.condarc
# 加入
changeps1: False
exit #重启
```



## WSL2

### 获取主机ip

> https://lengthmin.me/posts/wsl2-network-tricks/

wsl2与主机地址不再共享

```bash
ip route | grep default | awk '{print $3}'
```

### 配置homestead环境

```bash
git clone https://github.com/laravel/homestead #下载homestead库
git checkout 20.04 #切换至20.04分支
sudo -E ./bin/wsl-init #运行脚本
```

#### 挂载网站

```yaml
wsl_sites:
        -   map: vcdt.test
            to: /mnt/c/Users/halo/Code/vcdt/public
```

```bash
./bin/homestead wsl:create-sites
```

配置文件会被自动写入nginx，此时访问`127.0.0.1`(或者编辑以下windows下的hosts文件后直接访问域名)应该就能看到网站上线了。如果看不到的话，可以参考一下[这篇文章](https://lengthmin.me/posts/wsl2-network-tricks/)，获取wsl2虚拟机的ip之后再尝试。
#### 遇到的一些问题
##### mysql密码
查看脚本发现配置和homestead虚拟机上一样，用户名为`homestead`,密码为`secret`.
##### 网站响应速度十分之慢
这个我查了一下好像是wsl2文件io的问题，访问windows盘的速度特别慢，而且暂时无解。可以看
- [Major performance (I/O?) issue in /mnt/* and in ~ (home)](https://github.com/Microsoft/WSL/issues/873)

唯一的解决办法就是把网站目录放在wsl系统里……对比图:
wsl2目录下:
![WSL2配置laravel环境](https://cdn.learnku.com/uploads/images/202010/04/57015/5Dx0YUxyqL.png!large)
windows本地目录:

![WSL2配置laravel环境](https://cdn.learnku.com/uploads/images/202010/04/57015/wSZqhleQWW.png!large)
##### 重启后网站无法加载
查了下好像是wsl2的service不会自动开启。。。这个只能手动搞了，或者在.bashrc中写入
```bash
sudo service nginx restart
sudo service php7.4-fpm restart
sudo service mysql restart
```

或者参考

> https://github.com/shayne/wsl2-hacks/blob/master/README.md

开启systemd服务。

## 命令

### Screen

```bash
screen -s (name)#创建名为name的screen
ctrl+a d#退出当前screen
screen -ls #列出当前screen
screen -r (name) #返回名为name的screen
```

