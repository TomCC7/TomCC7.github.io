<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css"><script class="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"tomcc7.github.io",root:"/",images:"/images",scheme:"Gemini",version:"8.2.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12},copycode:!0,bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"fadeInDown",post_body:"fadeInDown",coll_header:"fadeInLeft",sidebar:"fadeInUp"}},prism:!1,i18n:{placeholder:"搜索...",empty:"没有找到任何搜索结果：${query}",hits_time:"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）",hits:"找到 ${hits} 个搜索结果"}}</script><meta name="description" content="cc.log"><meta property="og:type" content="website"><meta property="og:title" content="CClog"><meta property="og:url" content="http://tomcc7.github.io/index.html"><meta property="og:site_name" content="CClog"><meta property="og:description" content="cc.log"><meta property="og:locale" content="zh_CN"><meta property="article:author" content="PlayerCC7"><meta name="twitter:card" content="summary"><link rel="canonical" href="http://tomcc7.github.io/"><script class="page-configurations">CONFIG.page={sidebar:"",isHome:!0,isPost:!1,lang:"zh-CN"}</script><title>CClog</title><noscript><style>body{margin-top:2rem}.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header,.use-motion .sidebar{visibility:visible}.use-motion .footer,.use-motion .header,.use-motion .site-brand-container .toggle{opacity:initial}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line{transform:scaleX(1)}.search-pop-overlay,.sidebar-nav{display:none}.sidebar-panel{display:block}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">CClog</h1><i class="logo-line"></i></a></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li></ul></nav></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-overview-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">PlayerCC7</p><div class="site-description" itemprop="description">cc.log</div></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">11</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">4</span> <span class="site-state-item-name">分类</span></a></div></nav></div></div></div></div></aside><div class="sidebar-dimmer"></div></header><div class="back-to-top" role="button"><i class="fa fa-arrow-up"></i> <span>0%</span></div><a href="https://github.com/tomcc7" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner index posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://tomcc7.github.io/1970/01/01/2020-10-19-bashscript/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="PlayerCC7"><meta itemprop="description" content="cc.log"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="CClog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/1970/01/01/2020-10-19-bashscript/" class="post-title-link" itemprop="url">Bash Scripts Notes</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：1970-01-01 08:00:00" itemprop="dateCreated datePublished" datetime="1970-01-01T08:00:00+08:00">1970-01-01</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-01-27 22:03:02" itemprop="dateModified" datetime="2021-01-27T22:03:02+08:00">2021-01-27</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/references/" itemprop="url" rel="index"><span itemprop="name">references</span></a></span></span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="Commands"><a href="#Commands" class="headerlink" title="Commands"></a>Commands</h1><h2 id="Screen"><a href="#Screen" class="headerlink" title="Screen"></a>Screen</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">screen -S (name)<span class="comment">#创建名为name的screen</span></span><br><span class="line">ctrl+a d<span class="comment">#退出当前screen</span></span><br><span class="line">screen -ls <span class="comment">#列出当前screen</span></span><br><span class="line">screen -r (name) <span class="comment">#返回名为name的screen</span></span><br></pre></td></tr></table></figure><h2 id="sed-stream-editor"><a href="#sed-stream-editor" class="headerlink" title="sed (stream editor)"></a>sed (stream editor)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&quot;s?pattern?change?&quot;</span> <span class="comment"># change pattern of input</span></span><br><span class="line">sed -i <span class="string">&quot;...&quot;</span> file <span class="comment"># change file directly</span></span><br></pre></td></tr></table></figure><h2 id="jq-command-line-json-processor"><a href="#jq-command-line-json-processor" class="headerlink" title="jq (command-line json processor)"></a>jq (command-line json processor)</h2><blockquote><p><a target="_blank" rel="noopener" href="https://cameronnokes.com/blog/working-with-json-in-bash-using-jq/">https://cameronnokes.com/blog/working-with-json-in-bash-using-jq/</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># basic usage</span></span><br><span class="line">jq <span class="string">&quot;operation&quot;</span> <span class="string">&#x27;input&#x27;</span></span><br><span class="line"><span class="comment"># examples</span></span><br><span class="line">jq . example.json <span class="comment"># parse example.json</span></span><br><span class="line">jq .key example.json <span class="comment"># show the value of key in root object</span></span><br><span class="line">jq .[2] example.json <span class="comment"># show the second object if root is array</span></span><br></pre></td></tr></table></figure><h1 id="Command-Line-Usages"><a href="#Command-Line-Usages" class="headerlink" title="Command Line Usages"></a>Command Line Usages</h1><h3 id="Run-command-with-envs"><a href="#Run-command-with-envs" class="headerlink" title="Run command with envs"></a>Run command with envs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo VAR=VALUE &lt;COMMANDS&gt;</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line"><span class="built_in">export</span> VAR=VALUE</span><br><span class="line">sudo -E &lt;COMMAND&gt; <span class="comment"># -E preserve envs</span></span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://tomcc7.github.io/1970/01/01/2020-10-19-laravel/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="PlayerCC7"><meta itemprop="description" content="cc.log"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="CClog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/1970/01/01/2020-10-19-laravel/" class="post-title-link" itemprop="url">Laravel Configuration</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：1970-01-01 08:00:00" itemprop="dateCreated datePublished" datetime="1970-01-01T08:00:00+08:00">1970-01-01</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-01-27 22:03:23" itemprop="dateModified" datetime="2021-01-27T22:03:23+08:00">2021-01-27</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/configurations/" itemprop="url" rel="index"><span itemprop="name">configurations</span></a></span></span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="Laravel配置问题"><a href="#Laravel配置问题" class="headerlink" title="Laravel配置问题"></a>Laravel配置问题</h1><h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><h3 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##安装php##</span></span><br><span class="line">sudo apt install software-properties-common</span><br><span class="line">sudo add-apt-repository ppa:ondrej/php <span class="comment">#添加库</span></span><br><span class="line">sudo apt update <span class="comment">#顺便再检查下更新</span></span><br><span class="line">sudo apt install php7.4...</span><br><span class="line"></span><br><span class="line"><span class="comment">##安装composer##</span></span><br><span class="line"><span class="comment">#下载composer installer</span></span><br><span class="line">php -r <span class="string">&quot;copy(&#x27;https://getcomposer.org/installer&#x27;, &#x27;composer-setup.php&#x27;);&quot;</span></span><br><span class="line"><span class="comment">#检查哈希值</span></span><br><span class="line">php -r <span class="string">&quot;if (hash_file(&#x27;sha384&#x27;, &#x27;composer-setup.php&#x27;) === &#x27;e0012edf3e80b6978849f5eff0d4b4e4c79ff1609dd1e613307e16318854d24ae64f26d17af3ef0bf7cfb710ca74755a&#x27;) &#123; echo &#x27;Installer verified&#x27;; &#125; else &#123; echo &#x27;Installer corrupt&#x27;; unlink(&#x27;composer-setup.php&#x27;); &#125; echo PHP_EOL;&quot;</span></span><br><span class="line"><span class="comment">#安装于/usr/local/bin</span></span><br><span class="line">sudo php composer-setup.php --install-dir=/usr/<span class="built_in">local</span>/bin --filename=composer</span><br><span class="line"><span class="comment">#换国内镜像</span></span><br><span class="line">composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/ </span><br></pre></td></tr></table></figure><h3 id="Mariadb"><a href="#Mariadb" class="headerlink" title="Mariadb"></a>Mariadb</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install mariadb-server mariadb-client <span class="comment">#安装</span></span><br><span class="line">sudo mysql_secure_installation <span class="comment">#设置密码</span></span><br></pre></td></tr></table></figure><h3 id="Apache2"><a href="#Apache2" class="headerlink" title="Apache2"></a>Apache2</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install apache2</span><br></pre></td></tr></table></figure><h2 id="Composer"><a href="#Composer" class="headerlink" title="Composer"></a>Composer</h2><h4 id="换源"><a href="#换源" class="headerlink" title="换源"></a>换源</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/</span><br><span class="line">composer config -g --<span class="built_in">unset</span> repos.packagist <span class="comment">#取消</span></span><br></pre></td></tr></table></figure><h3 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">composer self-update <span class="comment">#升级</span></span><br><span class="line">composer diagnose <span class="comment">#诊断</span></span><br><span class="line">composer clear <span class="comment">#清理缓存</span></span><br><span class="line">composer update --lock <span class="comment">#更新lock文件</span></span><br></pre></td></tr></table></figure><h2 id="扩展安装"><a href="#扩展安装" class="headerlink" title="扩展安装"></a>扩展安装</h2><h3 id="扩展列表"><a href="#扩展列表" class="headerlink" title="扩展列表"></a>扩展列表</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">composer require laravel/ui:^1.0 --dev <span class="comment"># ui</span></span><br><span class="line">php artisan ui bootstrap <span class="comment">#引入bootstrap</span></span><br><span class="line">php artisan ui:auth <span class="comment">#用户认证脚手架</span></span><br><span class="line">composer require <span class="string">&quot;mews/captcha:~3.0&quot;</span> <span class="comment">#验证码</span></span><br><span class="line">composer require intervention/image <span class="comment">#intervention/image</span></span><br><span class="line">composer require <span class="string">&quot;barryvdh/laravel-debugbar:~3.2&quot;</span> --dev <span class="comment">#debugger</span></span><br><span class="line">composer require <span class="string">&quot;mews/purifier:~3.0&quot;</span> <span class="comment"># html purifier</span></span><br><span class="line">composer require <span class="string">&quot;guzzlehttp/guzzle:~6.3&quot;</span> <span class="comment"># guzzle</span></span><br><span class="line">composer require <span class="string">&quot;overtrue/pinyin:~4.0&quot;</span> <span class="comment"># 中文转拼音</span></span><br><span class="line">composer require <span class="string">&quot;predis/predis:~1.1&quot;</span> <span class="comment">#predis队列驱动</span></span><br></pre></td></tr></table></figure><h3 id="mews-captcha"><a href="#mews-captcha" class="headerlink" title="mews/captcha"></a>mews/captcha</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">composer require <span class="string">&quot;mews/captcha:~3.0&quot;</span> <span class="comment">#验证码</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="报错解决"><a href="#报错解决" class="headerlink" title="报错解决"></a>报错解决</h2><h3 id="Laravel-5-4-Specified-key-was-too-long-error"><a href="#Laravel-5-4-Specified-key-was-too-long-error" class="headerlink" title="Laravel 5.4: Specified key was too long error"></a>Laravel 5.4: Specified key was too long error</h3><p>修改AppServiceProvider中的boot方法:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Schema</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Schema::defaultStringLength(<span class="number">191</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="SQLSTATE-42S01-Base-table-or-view-already-exists-1050-Table-‘users’-already-exists"><a href="#SQLSTATE-42S01-Base-table-or-view-already-exists-1050-Table-‘users’-already-exists" class="headerlink" title="SQLSTATE[42S01]: Base table or view already exists: 1050 Table ‘users’ already exists"></a>SQLSTATE[42S01]: Base table or view already exists: 1050 Table ‘users’ already exists</h3><p>重置数据库:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan migrate:reset </span><br></pre></td></tr></table></figure><h1 id="Deploy-Laravel"><a href="#Deploy-Laravel" class="headerlink" title="Deploy Laravel"></a>Deploy Laravel</h1><blockquote><p><a target="_blank" rel="noopener" href="https://www.hostinger.com/tutorials/how-to-install-laravel-on-ubuntu-18-04-with-apache-and-php/#Using-Laravel-to-Deploy-an-Application">https://www.hostinger.com/tutorials/how-to-install-laravel-on-ubuntu-18-04-with-apache-and-php/#Using-Laravel-to-Deploy-an-Application</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo chgrp -R www-data /var/www/html/example/</span><br><span class="line">sudo chmod -R 775 /var/www/html/example/storage</span><br><span class="line"><span class="built_in">cd</span> /etc/apache2/sites-available</span><br><span class="line">sudo vim laravel_project.conf <span class="comment"># create coonfiguration file</span></span><br></pre></td></tr></table></figure><p>Add the following to create the new Virtual host. Remember to replace <strong>thedomain.com</strong> with your server’s <strong>IP address</strong>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost *:&#123;port&#125;&gt;</span><br><span class="line">   ServerName thedomain.com</span><br><span class="line">   ServerAdmin webmaster@thedomain.com</span><br><span class="line">   DocumentRoot /var/www/html/example/public</span><br><span class="line"></span><br><span class="line">   &lt;Directory /var/www/html/example&gt;</span><br><span class="line">       AllowOverride All</span><br><span class="line">   &lt;/Directory&gt;</span><br><span class="line">   ErrorLog <span class="variable">$&#123;APACHE_LOG_DIR&#125;</span>/error.log</span><br><span class="line">   CustomLog <span class="variable">$&#123;APACHE_LOG_DIR&#125;</span>/access.log combined</span><br><span class="line">   <span class="comment"># ssl</span></span><br><span class="line">   <span class="comment"># SSLEngine on</span></span><br><span class="line">   <span class="comment"># SSLCertificateFile /etc/ssl/&lt;key&gt;.crt</span></span><br><span class="line">   <span class="comment"># SSLCertificateKeyFile /etc/ssl/private/&lt;key&gt;.key</span></span><br><span class="line">   <span class="comment"># SSLCertificateChainFile /etc/ssl/&lt;key&gt;.ca-bundle</span></span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo a2dissite 000-default.conf</span><br><span class="line">sudo a2ensite laravel_project</span><br><span class="line">sudo a2enmod rewrite <span class="comment"># important</span></span><br><span class="line">sudo systemctl restart apache2</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://tomcc7.github.io/1970/01/01/2020-10-19-NAS/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="PlayerCC7"><meta itemprop="description" content="cc.log"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="CClog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/1970/01/01/2020-10-19-NAS/" class="post-title-link" itemprop="url">NAS Configuration</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：1970-01-01 08:00:00" itemprop="dateCreated datePublished" datetime="1970-01-01T08:00:00+08:00">1970-01-01</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-01-27 21:59:31" itemprop="dateModified" datetime="2021-01-27T21:59:31+08:00">2021-01-27</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/configurations/" itemprop="url" rel="index"><span itemprop="name">configurations</span></a></span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>[TOC]</p><h2 id="LAMP环境搭建"><a href="#LAMP环境搭建" class="headerlink" title="LAMP环境搭建"></a>LAMP环境搭建</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>​ LAMP是一套建站环境的缩写，nextcloud必须依赖这套环境才能运行。其中linux系统我们已经有了，还需要安装其它三个。</p><p><img src="https://www.player7.cc:44343/uploads/big/dd322ee03d6c8a2f496ba21481f66672.png" alt="lamp"></p><h3 id="1-PHP"><a href="#1-PHP" class="headerlink" title="1. PHP"></a>1. PHP</h3><p>​ 这里选用php7.3版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install php7.3 <span class="comment">#安装php</span></span><br><span class="line"></span><br><span class="line">sudo apt install php7.3-mysql php7.3-zip php7.3-xml php7.3-intl php7.3-mbstring php7.3-gd php7.3-curl <span class="comment">#安装依赖模块</span></span><br></pre></td></tr></table></figure><h3 id="2-Apache2"><a href="#2-Apache2" class="headerlink" title="2. Apache2"></a>2. Apache2</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install apache2 libapache2-mod-php <span class="comment">#安装apache2和php解析模块</span></span><br><span class="line"></span><br><span class="line">sudo systemctl restart apache2 <span class="comment">#启动</span></span><br></pre></td></tr></table></figure><h3 id="3-MySQL（Mariadb）"><a href="#3-MySQL（Mariadb）" class="headerlink" title="3. MySQL（Mariadb）"></a>3. MySQL（Mariadb）</h3><h4 id="3-1-下载"><a href="#3-1-下载" class="headerlink" title="3.1 下载"></a>3.1 下载</h4><p>​ 这里使用的<strong>Mariadb</strong>是<strong>MySQL</strong>的一套开源版本，可以完全兼容mysql的命令。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install mariadb-server</span><br></pre></td></tr></table></figure><h4 id="3-2-配置数据库"><a href="#3-2-配置数据库" class="headerlink" title="3.2 配置数据库"></a>3.2 配置数据库</h4><p>​ 输入命令：<code>sudo mysql -u root</code> 进入管理界面。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> nextcloud;#创建数据库</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">ON</span> nextcloud.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;密码&#x27;</span>; #创建用户并授予权限</span><br><span class="line">quit;#退出到bash</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart mariadb <span class="comment">#重启服务使之生效</span></span><br></pre></td></tr></table></figure><h2 id="Nextcloud"><a href="#Nextcloud" class="headerlink" title="Nextcloud"></a>Nextcloud</h2><ol><li>从<a target="_blank" rel="noopener" href="https://nextcloud.com/install/">官网</a>下载最新版软件：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://download.nextcloud.com/server/releases/nextcloud-18.0.1.zip <span class="comment">#下载</span></span><br><span class="line">sudo unzip nextcloud-18.0.0.zip -d /var/www/html <span class="comment">#解压缩到apache服务器根目录下</span></span><br><span class="line">sudo chown -R www-data:www-data /var/www/html/nextcloud/ <span class="comment">#设置权限</span></span><br></pre></td></tr></table></figure><p>​ 现在在浏览器访问<code>http://树莓派ip/nextcloud</code>应有如下界面：</p><p><img src="https://www.player7.cc:44343/uploads/big/5039d2c6b58d95617f39da5e004e457b.png" alt="nextcloudlogin"></p><ol start="2"><li><p>接下来我们要设置存放数据的data目录。由于要将数据存放在移动硬盘中，我们需要先挂载硬盘。</p><p>为了挂载硬盘，首先我们要获取硬盘的<strong>uuid</strong>(Universally Unique IDentifiers)：</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l /dev/disk/by-uuid</span><br></pre></td></tr></table></figure><p><img src="https://www.player7.cc:44343/uploads/big/a845f237450825dc5c78fb116161449a.png" alt="uuid"></p><p>​ 上图最后一行../../sda1即为我们的移动硬盘，而<code>8EA8F491A8F47953</code>即为硬盘特有的UUID。</p><p>​ 修改fstab文件自动挂载硬盘：<code>sudo nano /etc/fstab</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#将以下内容更改后复制进文件末尾</span><br><span class="line">UUID&#x3D;之前获得的UUID &#x2F;mnt&#x2F;drive auto nofail,uid&#x3D;33,gid&#x3D;33,umask&#x3D;0027,dmask&#x3D;0027,noatime 0 0</span><br></pre></td></tr></table></figure><p>​ 保存退出后后输入<code>sudo reboot</code>重启系统，挂载完成。</p><hr><p>​ 创建data目录:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /mnt/drive/data/ <span class="comment">#创建目录</span></span><br><span class="line">sudo chown -R www-data:www-data /mnt/drive/data <span class="comment">#修改权限</span></span><br></pre></td></tr></table></figure><p>​ 接下来我们重新打开云盘页面：</p><p><img src="https://www.player7.cc:44343/uploads/big/8d0bf7ef46213fcd8e16ca46ed48e42d.png" alt="nextcloudlogin"></p><p>依次填入所需信息后确认：</p><ul><li><p>管理员账号是云盘的登录名和密码，可以自己设置</p></li><li><p>数据目录为刚刚创建的data文件夹:/mnt/drive/data</p></li><li><p>数据库名为<code>nextcloud</code>，用户名密码为[配置数据库](#3.2 配置数据库)时创建的用户名和密码。</p></li></ul><p><img src="/home/cc/Documents/notes/photos/nextcloudlogin2.png" alt="登录界面"></p><p>​ 这样我们的nextcloud云盘就可以在内网下使用了。</p><h3 id="OCC命令"><a href="#OCC命令" class="headerlink" title="OCC命令"></a>OCC命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> nextcloud <span class="comment">#切换到nextcloud根目录</span></span><br><span class="line">sudo -u www-data php occ files:scan ccadmin --verbose <span class="comment">#扫描文件并显示输出</span></span><br></pre></td></tr></table></figure><h2 id="将多块系统盘合并"><a href="#将多块系统盘合并" class="headerlink" title="将多块系统盘合并"></a>将多块系统盘合并</h2><blockquote><p><a target="_blank" rel="noopener" href="https://wzyboy.im/post/1148.html">https://wzyboy.im/post/1148.html</a></p></blockquote><ol><li>下载<a target="_blank" rel="noopener" href="https://github.com/trapexit/mergerfs">mergerfs</a></li><li>挂载</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/mnt/disk1T:/mnt/disk2  /mnt/vdisk    fuse.mergerfs defaults,noauto,allow_other,use_ino,minfreespace=100G,ignorepponrename=<span class="literal">true</span> 0 0</span><br></pre></td></tr></table></figure><ul><li><code>defaults</code>: 开启以下 FUSE 参数以提升性能：atomic_o_trunc, auto_cache, big_writes, default_permissions, splice_move, splice_read, splice_write；</li><li><code>noauto</code>: 禁止开机自动挂载。意外关机重启之后我可能需要手动检查文件系统后再挂载，所以我不希望它自动挂载；</li><li><code>allow_other</code>: 允许挂载者以外的用户访问 FUSE。你可能需要编辑 <code>/etc/fuse.conf</code> 来允许这一选项；</li><li><code>use_ino</code>: 使用 mergerfs 而不是 libfuse 提供的 inode，使硬链接的文件 inode 一致；</li><li><code>minfreespace=100G</code>: 选择往哪个下层文件系统写文件时，跳过剩余空间低于 100G 的文件系统；</li><li><code>ignorepponrename=true</code>: 重命名文件时，不再遵守路径保留原则，见下一节详解。</li></ul></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://tomcc7.github.io/1970/01/01/2020-10-19-linux/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="PlayerCC7"><meta itemprop="description" content="cc.log"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="CClog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/1970/01/01/2020-10-19-linux/" class="post-title-link" itemprop="url">Linux notes</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：1970-01-01 08:00:00" itemprop="dateCreated datePublished" datetime="1970-01-01T08:00:00+08:00">1970-01-01</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-01-27 22:00:46" itemprop="dateModified" datetime="2021-01-27T22:00:46+08:00">2021-01-27</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/references/" itemprop="url" rel="index"><span itemprop="name">references</span></a></span></span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="linux笔记"><a href="#linux笔记" class="headerlink" title="linux笔记"></a>linux笔记</h1><p>[toc]</p><h2 id="系统"><a href="#系统" class="headerlink" title="系统"></a>系统</h2><h3 id="换源"><a href="#换源" class="headerlink" title="换源"></a>换源</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/apt/sources.list <span class="comment">#编辑sources.list</span></span><br><span class="line"><span class="comment">#官方指导: https://developer.aliyun.com/mirror/ubuntu</span></span><br><span class="line"><span class="comment">#粘帖以下</span></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure><h3 id="硬盘挂载"><a href="#硬盘挂载" class="headerlink" title="硬盘挂载"></a>硬盘挂载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls -lh /dev/disk/by-uuid <span class="comment">#查看硬盘uuid</span></span><br><span class="line">sudo vim /etc/fstab <span class="comment">#修改启动文件</span></span><br><span class="line">UUID=... /mnt/share ntfs-3g rw,uid=...,gid=...,<span class="built_in">umask</span>=0000,locale=zh_CN.utf8,defaults 0 0</span><br></pre></td></tr></table></figure><h3 id="获取gid和uid"><a href="#获取gid和uid" class="headerlink" title="获取gid和uid"></a>获取gid和uid</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id -u username <span class="comment">#uid</span></span><br><span class="line">id -g username <span class="comment">#gid</span></span><br></pre></td></tr></table></figure><h3 id="添加Windows字体"><a href="#添加Windows字体" class="headerlink" title="添加Windows字体"></a>添加Windows字体</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo cp -r <span class="comment">#字体文件夹# /usr/share/fonts/WinFonts #复制文件夹</span></span><br><span class="line">sudo chmod -R 755 /usr/share/fonts/WinFonts <span class="comment">#设置权限</span></span><br><span class="line">fc-cache <span class="comment">#生成缓存</span></span><br></pre></td></tr></table></figure><h3 id="系统键盘禁用"><a href="#系统键盘禁用" class="headerlink" title="系统键盘禁用"></a>系统键盘禁用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xinput <span class="comment">#查看输入设备</span></span><br><span class="line">xinput set-prop (键盘序号) <span class="string">&quot;Device Enabled&quot;</span> 0</span><br></pre></td></tr></table></figure><h3 id="连接vpn"><a href="#连接vpn" class="headerlink" title="连接vpn"></a>连接vpn</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install strongswan network-manager-strongswan libcharon-extra-plugins</span><br><span class="line">sudo vim /etc/ipsec.conf <span class="comment">#编辑conf文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 将jAccount替换为自己的jaccount ###</span></span><br><span class="line"><span class="comment"># ipsec.conf - strongSwan IPsec configuration file</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># basic configuration</span></span><br><span class="line"></span><br><span class="line">config setup</span><br><span class="line">	<span class="comment"># strictcrlpolicy=yes</span></span><br><span class="line">	<span class="comment"># uniqueids = no</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Add connections here.</span></span><br><span class="line"></span><br><span class="line">conn sjtu</span><br><span class="line">	left=%config</span><br><span class="line">	leftsourceip=%config</span><br><span class="line">	leftauth=eap-gtc</span><br><span class="line">	right=stu.vpn.sjtu.edu.cn</span><br><span class="line">	rightsubnet=0.0.0.0/0</span><br><span class="line">	rightid=@stu.vpn.sjtu.edu.cn</span><br><span class="line">	rightauth=pubkey</span><br><span class="line">	eap_identity=jAccount</span><br><span class="line">	auto=add</span><br><span class="line"><span class="comment">##################</span></span><br><span class="line">sudo vim /etc/ipsec.secrets <span class="comment">#编辑密码文件</span></span><br><span class="line"><span class="comment">#####</span></span><br><span class="line">jAccount : EAP <span class="string">&quot;Your Password&quot;</span></span><br><span class="line"><span class="comment">#####</span></span><br><span class="line">sudo cp -r /etc/ssl/certs/* /etc/ipsec.d/cacerts <span class="comment">#拷贝证书</span></span><br><span class="line">sudo ipsec start <span class="comment">#开启vpn服务</span></span><br><span class="line">sudo ipsec up sjtu <span class="comment">#连接sjtu vpn</span></span><br><span class="line">sudo dpkg-reconfigure resolvconf <span class="comment"># 解决pop-os无法连接dns服务器的bug，，，</span></span><br></pre></td></tr></table></figure><h3 id="Setting-proxy"><a href="#Setting-proxy" class="headerlink" title="Setting proxy"></a>Setting proxy</h3><blockquote><p><a target="_blank" rel="noopener" href="https://yechengfu.com/blog/2015/01/16/use-git-behind-proxy/">https://yechengfu.com/blog/2015/01/16/use-git-behind-proxy/</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">vpn</span></span>() &#123;</span><br><span class="line">  HTTP_PROXY=http://127.0.0.1:8889</span><br><span class="line">  <span class="keyword">if</span> [[ <span class="variable">$1</span> != <span class="string">&quot;off&quot;</span> ]];</span><br><span class="line">  <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">export</span> http_proxy=<span class="variable">$HTTP_PROXY</span></span><br><span class="line">  <span class="built_in">export</span> https_proxy=<span class="variable">$HTTP_PROXY</span></span><br><span class="line">  <span class="built_in">export</span> all_proxy=<span class="variable">$HTTP_PROXY</span></span><br><span class="line">  <span class="comment"># only for &#x27;github.com&#x27;</span></span><br><span class="line">  git config --global http.https://github.com.proxy <span class="variable">$HTTP_PROXY</span></span><br><span class="line">  <span class="comment"># use &#x27;connect&#x27; with HTTP_PROXY environment</span></span><br><span class="line">  <span class="built_in">export</span> GIT_SSH_COMMAND=<span class="string">&#x27;ssh -o ProxyCommand=&quot;nc -X connect -x 127.0.0.1:8889 %h %p&quot;&#x27;</span></span><br><span class="line">  git config --global core.gitproxy <span class="string">&quot;/usr/bin/gitproxy for github.com&quot;</span></span><br><span class="line">  <span class="comment"># echo</span></span><br><span class="line">  <span class="built_in">echo</span> vpn started!</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">unset</span> http_proxy</span><br><span class="line">  <span class="built_in">unset</span> https_proxy</span><br><span class="line">  <span class="built_in">unset</span> all_proxy</span><br><span class="line">  <span class="built_in">unset</span> GIT_SSH_COMMAND</span><br><span class="line">  git config --global --<span class="built_in">unset</span> core.gitproxy</span><br><span class="line">  <span class="built_in">echo</span> vpn off</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>\usr\bin\gitproxy</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Proxy wrapper for git protocol (9418).</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># git config --global core.gitproxy &quot;ido gitproxy&quot;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">exec</span> /usr/bin/nc -X 5 -x &lt;socks_host&gt;:&lt;socks_port&gt; <span class="variable">$1</span> <span class="variable">$2</span></span><br></pre></td></tr></table></figure><h3 id="问题排查"><a href="#问题排查" class="headerlink" title="问题排查"></a>问题排查</h3><h4 id="不小心删了bash"><a href="#不小心删了bash" class="headerlink" title="不小心删了bash"></a>不小心删了bash</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /bin/sh /bin/bash</span><br><span class="line">sudo apt install --reinstall bash</span><br></pre></td></tr></table></figure><h2 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h2><h3 id="ZSH"><a href="#ZSH" class="headerlink" title="ZSH"></a>ZSH</h3><h4 id="安装-oh-my-zsh"><a href="#安装-oh-my-zsh" class="headerlink" title="安装 oh-my-zsh"></a>安装 oh-my-zsh</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install zsh</span><br><span class="line">sh -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)</span>&quot;</span></span><br><span class="line">sudo usermod -s /bin/zsh username <span class="comment">#设置默认shell</span></span><br></pre></td></tr></table></figure><h4 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h4><ul><li><p>zsh-syntax-highlighting: <a target="_blank" rel="noopener" href="https://github.com/zsh-users/zsh-syntax-highlighting">https://github.com/zsh-users/zsh-syntax-highlighting</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting.git <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-syntax-highlighting</span><br></pre></td></tr></table></figure></li><li><p>git-open: <a target="_blank" rel="noopener" href="https://github.com/paulirish/git-open">https://github.com/paulirish/git-open</a></p></li><li><p>zsh-autosuggestions: <a target="_blank" rel="noopener" href="https://github.com/zsh-users/zsh-autosuggestions">https://github.com/zsh-users/zsh-autosuggestions</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-autosuggestions</span><br></pre></td></tr></table></figure><ul><li>extract</li><li>rand-quote</li><li>themes</li><li>gitignore</li><li>cp</li><li>zsh_reload</li></ul><h3 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##安装php##</span></span><br><span class="line">sudo apt install software-properties-common</span><br><span class="line">sudo add-apt-repository ppa:ondrej/php <span class="comment">#添加库</span></span><br><span class="line">sudo apt update <span class="comment">#顺便再检查下更新</span></span><br><span class="line">sudo apt install php7.4...</span><br><span class="line"></span><br><span class="line"><span class="comment">##安装composer##</span></span><br><span class="line"><span class="comment">#下载composer installer</span></span><br><span class="line">php -r <span class="string">&quot;copy(&#x27;https://getcomposer.org/installer&#x27;, &#x27;composer-setup.php&#x27;);&quot;</span></span><br><span class="line"><span class="comment">#检查哈希值</span></span><br><span class="line">php -r <span class="string">&quot;if (hash_file(&#x27;sha384&#x27;, &#x27;composer-setup.php&#x27;) === &#x27;e0012edf3e80b6978849f5eff0d4b4e4c79ff1609dd1e613307e16318854d24ae64f26d17af3ef0bf7cfb710ca74755a&#x27;) &#123; echo &#x27;Installer verified&#x27;; &#125; else &#123; echo &#x27;Installer corrupt&#x27;; unlink(&#x27;composer-setup.php&#x27;); &#125; echo PHP_EOL;&quot;</span></span><br><span class="line"><span class="comment">#安装于/usr/local/bin</span></span><br><span class="line">sudo php composer-setup.php --install-dir=/usr/<span class="built_in">local</span>/bin --filename=composer</span><br><span class="line"><span class="comment">#换国内镜像</span></span><br><span class="line">composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/ </span><br></pre></td></tr></table></figure><h3 id="Mariadb"><a href="#Mariadb" class="headerlink" title="Mariadb"></a>Mariadb</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install mariadb-server mariadb-client <span class="comment">#安装</span></span><br><span class="line">sudo mysql_secure_installation <span class="comment">#设置密码</span></span><br></pre></td></tr></table></figure><h4 id="ERROR-1698-28000-Access-denied-for-user-‘root’-’localhost’"><a href="#ERROR-1698-28000-Access-denied-for-user-‘root’-’localhost’" class="headerlink" title="ERROR 1698 (28000): Access denied for user ‘root’@’localhost’"></a>ERROR 1698 (28000): Access denied for user ‘root’@’localhost’</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo mysql -u root</span><br><span class="line"></span><br><span class="line">USE mysql;</span><br><span class="line">UPDATE user SET plugin=<span class="string">&#x27;mysql_native_password&#x27;</span> WHERE User=<span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"><span class="built_in">exit</span>;</span><br><span class="line"></span><br><span class="line">service mysql restart</span><br></pre></td></tr></table></figure><h4 id="一些操作"><a href="#一些操作" class="headerlink" title="一些操作"></a>一些操作</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">USE ...; #选择数据库</span><br><span class="line">SELECT * FROM ...; #选择表</span><br><span class="line">CREATE DATABASE ...; #创建数据库</span><br><span class="line">CREATE TABLE ...; #创建表</span><br><span class="line">DROP TABLE ...; #丢弃表</span><br><span class="line">DROP DATABASE ...; #丢弃数据库</span><br><span class="line">GRANT ALL ON ... .* TO ... ; #数据库授权</span><br><span class="line">SOURCE .... ;#导入文件</span><br></pre></td></tr></table></figure><h3 id="Deepin-Wine-TIM-QQ"><a href="#Deepin-Wine-TIM-QQ" class="headerlink" title="Deepin-Wine TIM,QQ"></a>Deepin-Wine TIM,QQ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://gitee.com/wszqkzqk/deepin-wine-for-ubuntu.git <span class="comment">#下载项目</span></span><br><span class="line"><span class="built_in">cd</span> deepin-wine-for-ubuntu <span class="comment">#进入目录</span></span><br><span class="line">bash ./install.sh <span class="comment">#运行安装</span></span><br></pre></td></tr></table></figure><h3 id="Anaconda"><a href="#Anaconda" class="headerlink" title="Anaconda"></a>Anaconda</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> Downloads</span><br><span class="line">wget https://repo.anaconda.com/archive/Anaconda3-2019.10-Linux-x86_64.sh</span><br><span class="line">./Anaconda3-2019.10-Linux-x86_64.sh</span><br></pre></td></tr></table></figure><h4 id="解决zsh显示（base）的问题"><a href="#解决zsh显示（base）的问题" class="headerlink" title="解决zsh显示（base）的问题"></a>解决zsh显示（base）的问题</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.condarc</span><br><span class="line"><span class="comment"># 加入</span></span><br><span class="line">changeps1: False</span><br><span class="line"><span class="built_in">exit</span> <span class="comment">#重启</span></span><br></pre></td></tr></table></figure><h2 id="WSL2"><a href="#WSL2" class="headerlink" title="WSL2"></a>WSL2</h2><h3 id="获取主机ip"><a href="#获取主机ip" class="headerlink" title="获取主机ip"></a>获取主机ip</h3><blockquote><p><a target="_blank" rel="noopener" href="https://lengthmin.me/posts/wsl2-network-tricks/">https://lengthmin.me/posts/wsl2-network-tricks/</a></p></blockquote><p>wsl2与主机地址不再共享</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip route | grep default | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="配置homestead环境"><a href="#配置homestead环境" class="headerlink" title="配置homestead环境"></a>配置homestead环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/laravel/homestead <span class="comment">#下载homestead库</span></span><br><span class="line">git checkout 20.04 <span class="comment">#切换至20.04分支</span></span><br><span class="line">sudo -E ./bin/wsl-init <span class="comment">#运行脚本</span></span><br></pre></td></tr></table></figure><h4 id="挂载网站"><a href="#挂载网站" class="headerlink" title="挂载网站"></a>挂载网站</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">wsl_sites:</span></span><br><span class="line">        <span class="bullet">-</span>   <span class="attr">map:</span> <span class="string">vcdt.test</span></span><br><span class="line">            <span class="attr">to:</span> <span class="string">/mnt/c/Users/halo/Code/vcdt/public</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/homestead wsl:create-sites</span><br></pre></td></tr></table></figure><p>配置文件会被自动写入nginx，此时访问<code>127.0.0.1</code>(或者编辑以下windows下的hosts文件后直接访问域名)应该就能看到网站上线了。如果看不到的话，可以参考一下<a target="_blank" rel="noopener" href="https://lengthmin.me/posts/wsl2-network-tricks/">这篇文章</a>，获取wsl2虚拟机的ip之后再尝试。</p><h4 id="遇到的一些问题"><a href="#遇到的一些问题" class="headerlink" title="遇到的一些问题"></a>遇到的一些问题</h4><h5 id="mysql密码"><a href="#mysql密码" class="headerlink" title="mysql密码"></a>mysql密码</h5><p>查看脚本发现配置和homestead虚拟机上一样，用户名为<code>homestead</code>,密码为<code>secret</code>.</p><h5 id="网站响应速度十分之慢"><a href="#网站响应速度十分之慢" class="headerlink" title="网站响应速度十分之慢"></a>网站响应速度十分之慢</h5><p>这个我查了一下好像是wsl2文件io的问题，访问windows盘的速度特别慢，而且暂时无解。可以看</p><ul><li><a target="_blank" rel="noopener" href="https://github.com/Microsoft/WSL/issues/873">Major performance (I/O?) issue in /mnt/* and in ~ (home)</a></li></ul><p>唯一的解决办法就是把网站目录放在wsl系统里……对比图:<br>wsl2目录下:<br><img src="https://cdn.learnku.com/uploads/images/202010/04/57015/5Dx0YUxyqL.png!large" alt="WSL2配置laravel环境"><br>windows本地目录:</p><p><img src="https://cdn.learnku.com/uploads/images/202010/04/57015/wSZqhleQWW.png!large" alt="WSL2配置laravel环境"></p><h5 id="重启后网站无法加载"><a href="#重启后网站无法加载" class="headerlink" title="重启后网站无法加载"></a>重启后网站无法加载</h5><p>查了下好像是wsl2的service不会自动开启。。。这个只能手动搞了，或者在.bashrc中写入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo service nginx restart</span><br><span class="line">sudo service php7.4-fpm restart</span><br><span class="line">sudo service mysql restart</span><br></pre></td></tr></table></figure><p>或者参考</p><blockquote><p><a target="_blank" rel="noopener" href="https://github.com/shayne/wsl2-hacks/blob/master/README.md">https://github.com/shayne/wsl2-hacks/blob/master/README.md</a></p></blockquote><p>开启systemd服务。</p><h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><h3 id="Screen"><a href="#Screen" class="headerlink" title="Screen"></a>Screen</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">screen -s (name)<span class="comment">#创建名为name的screen</span></span><br><span class="line">ctrl+a d<span class="comment">#退出当前screen</span></span><br><span class="line">screen -ls <span class="comment">#列出当前screen</span></span><br><span class="line">screen -r (name) <span class="comment">#返回名为name的screen</span></span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://tomcc7.github.io/1970/01/01/2020-10-19-opencv/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="PlayerCC7"><meta itemprop="description" content="cc.log"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="CClog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/1970/01/01/2020-10-19-opencv/" class="post-title-link" itemprop="url">OpenCV Notes</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：1970-01-01 08:00:00" itemprop="dateCreated datePublished" datetime="1970-01-01T08:00:00+08:00">1970-01-01</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-01-27 22:02:04" itemprop="dateModified" datetime="2021-01-27T22:02:04+08:00">2021-01-27</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/references/" itemprop="url" rel="index"><span itemprop="name">references</span></a></span></span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="学习参考"><a href="#学习参考" class="headerlink" title="学习参考"></a>学习参考</h1><ul><li>仿射变换<ul><li><a target="_blank" rel="noopener" href="https://www.matongxue.com/madocs/244/">https://www.matongxue.com/madocs/244/</a></li></ul></li><li>傅里叶变换<ul><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/99605178">https://zhuanlan.zhihu.com/p/99605178</a></li></ul></li><li>大津二值化<ul><li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Otsu%27s_method">https://en.wikipedia.org/wiki/Otsu%27s_method</a></li><li><a target="_blank" rel="noopener" href="https://learnopencv.com/otsu-thresholding-with-opencv/">https://learnopencv.com/otsu-thresholding-with-opencv/</a></li></ul></li></ul><h1 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h1><h2 id="Archlinux"><a href="#Archlinux" class="headerlink" title="Archlinux"></a>Archlinux</h2><h3 id="编译指令"><a href="#编译指令" class="headerlink" title="编译指令"></a>编译指令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dependencies</span></span><br><span class="line">aurman -S build-devel cmake libjpeg libtiff libpng xvidcore libx264 ffmpeg v4l-utils gtk3 libcanberra lapack gcc-fortran</span><br><span class="line"><span class="comment"># python</span></span><br><span class="line">sudo pip3 install virtualenv virtualenvwrapper</span><br><span class="line">mkvirtualenv cv -p python3</span><br><span class="line">workon cv</span><br><span class="line"><span class="comment"># deactivate</span></span><br><span class="line"><span class="built_in">cd</span> &lt;build&gt;</span><br><span class="line"><span class="comment"># cmake</span></span><br><span class="line">cmake -D CMAKE_INSTALL_PREFIX=/usr/<span class="built_in">local</span> \</span><br><span class="line">-D OPENCV_EXTRA_MODULES_PATH=../../opencv_contrib-4.1.0/modules/ \</span><br><span class="line">-D BUILD_TESTS=OFF \</span><br><span class="line">-D INSTALL_PYTHON_EXAMPLES=OFF \</span><br><span class="line">-D OPENCV_ENABLE_NONFREE=ON \</span><br><span class="line">-D BUILD_opencv_python3=TRUE \</span><br><span class="line">-D BUILD_EXAMPLES=OFF \</span><br><span class="line">-D WITH_OPENMP=ON \</span><br><span class="line">..</span><br><span class="line"><span class="comment"># make</span></span><br><span class="line">make -j6</span><br><span class="line">sudo make install</span><br><span class="line">sudo ldconfig</span><br></pre></td></tr></table></figure><h2 id="树梅派安装opencv"><a href="#树梅派安装opencv" class="headerlink" title="树梅派安装opencv"></a>树梅派安装opencv</h2><blockquote><p>参考：<a target="_blank" rel="noopener" href="https://www.pyimagesearch.com/2017/09/04/raspbian-stretch-install-opencv-3-python-on-your-raspberry-pi/">https://www.pyimagesearch.com/2017/09/04/raspbian-stretch-install-opencv-3-python-on-your-raspberry-pi/</a></p></blockquote><blockquote><p>非编译安装: <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/92184435">https://zhuanlan.zhihu.com/p/92184435</a></p></blockquote><h3 id="树梅派设置"><a href="#树梅派设置" class="headerlink" title="树梅派设置"></a>树梅派设置</h3><ol><li>将系统扩展至整个sd卡</li><li>把swap调大</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/dphys-swapfile</span><br><span class="line"><span class="comment"># 修改这行</span></span><br><span class="line">CONF_SWAPSIZE = 1024</span><br><span class="line"><span class="comment">#重启生效配置</span></span><br><span class="line">sudo /etc/init.d/dphys-swapfile restart</span><br></pre></td></tr></table></figure><h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># build</span></span><br><span class="line">sudo apt install build-essential cmake pkg-config -y</span><br><span class="line"><span class="comment"># figure processing</span></span><br><span class="line">sudo apt install libjpeg-dev libtiff5-dev libjasper-dev libpng12-dev -y</span><br><span class="line"><span class="comment"># image I/O</span></span><br><span class="line">sudo apt install libavcodec-dev libavformat-dev libswscale-dev libv4l-dev -y</span><br><span class="line">sudo apt install libxvidcore-dev libx264-dev -y</span><br><span class="line">sudo apt install libgtk2.0-dev libgtk-3-dev -y</span><br><span class="line">sudo apt install libatlas-base-dev gfortran -y</span><br><span class="line"><span class="comment"># install python</span></span><br><span class="line">sudo apt install python3-dev -y</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ubuntu</span></span><br><span class="line">sudo apt install build-essential </span><br><span class="line">sudo apt install cmake git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev</span><br><span class="line">sudo apt install python-dev python-numpy libtbb2 libtbb-dev libjpeg-dev libpng-dev libtiff-dev libdc1394-22-dev</span><br></pre></td></tr></table></figure><h3 id="下载opencv源码"><a href="#下载opencv源码" class="headerlink" title="下载opencv源码"></a>下载opencv源码</h3><ul><li><p><a target="_blank" rel="noopener" href="https://github.com/opencv/opencv/releases">opencv</a> - opencv官方仓库</p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/opencv/opencv_contrib">opencv_contrib</a> - opencv额外模组库</p><p>从以上仓库分别下载相同版本的代码，之后解压在同一文件夹下。</p></li></ul><h3 id="安装python虚拟环境"><a href="#安装python虚拟环境" class="headerlink" title="安装python虚拟环境"></a>安装python虚拟环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装virtualenv</span></span><br><span class="line">sudo python3 -m pip install virtualenv virtualenvwrapper</span><br><span class="line">sudo rm -rf ~/.cache/pip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加path</span></span><br><span class="line"><span class="comment"># 将以下复制到~/.profile中</span></span><br><span class="line"><span class="comment"># virtualenv and virtualenvwrapper</span></span><br><span class="line"><span class="built_in">export</span> WORKON_HOME=<span class="variable">$HOME</span>/.virtualenvs</span><br><span class="line"><span class="built_in">export</span> VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3</span><br><span class="line"><span class="built_in">source</span> /usr/<span class="built_in">local</span>/bin/virtualenvwrapper.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建虚拟环境</span></span><br><span class="line"><span class="built_in">source</span> ~/.profile <span class="comment">#引入环境变量</span></span><br><span class="line">mkvirtualenv cv -p python3 <span class="comment">#创建环境</span></span><br><span class="line">workon cv <span class="comment">#选择环境</span></span><br></pre></td></tr></table></figure><h3 id="安装numpy"><a href="#安装numpy" class="headerlink" title="安装numpy"></a>安装numpy</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m pip install numpy</span><br></pre></td></tr></table></figure><h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#确保处于opencv主文件夹内</span></span><br><span class="line">mkdir build &amp;&amp; <span class="built_in">cd</span> build <span class="comment">#创建build文件夹并进入</span></span><br><span class="line"><span class="comment">#运行cmake生成makefile文件 大概1分钟多</span></span><br><span class="line">cmake -D CMAKE_BUILD_TYPE=RELEASE \</span><br><span class="line">        -D OPENCV_EXTRA_MODULES_PATH=../../opencv_contrib-4.4.0/modules \</span><br><span class="line">        -D WITH_LIBV4L=ON \</span><br><span class="line">        -D WITH_CUDA=ON \</span><br><span class="line">        -D ENABLE_FAST_MATH=ON \</span><br><span class="line">        -D CUDA_FAST_MATH=ON \</span><br><span class="line">        -D WITH_CUBLAS=ON \</span><br><span class="line">        -D WITH_NVCUVID=ON \</span><br><span class="line">        -D CUDA_GENERATION=Auto \</span><br><span class="line">        -D WITH_TBB=ON \</span><br><span class="line">        -D WITH_OPENMP=ON \</span><br><span class="line">        -D WITH_OPENGL=ON \</span><br><span class="line">        -D PYTHON3_EXECUTABLE=/usr/bin/python3 \</span><br><span class="line">        -D PYTHON3_LIBRARY=/usr/lib/python3.8/config-3.8-x86_64-linux-gnu/libpython3.8.so \</span><br><span class="line">		-D INSTALL_C_EXAMPLES_=ON \</span><br><span class="line">		-D CMAKE_INSTALL_PREFIX=/usr/<span class="built_in">local</span> ..</span><br><span class="line"><span class="comment"># make,大概几个小时</span></span><br><span class="line">make -j4 <span class="comment">#这里会报错， 之后讲</span></span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">sudo make install</span><br><span class="line">sudo ldconfig</span><br></pre></td></tr></table></figure><h3 id="最后的收尾工作"><a href="#最后的收尾工作" class="headerlink" title="最后的收尾工作"></a>最后的收尾工作</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/lib/python3.x/site-packages/cv2/</span><br><span class="line"><span class="comment"># 寻找一个大概叫cv2.cpython-35m-arm-linux-gnueabihf.so的文件</span></span><br><span class="line"><span class="comment"># 改名为cv2.so</span></span><br><span class="line">sudo mv cv2.cpython-35m-arm-linux-gnueabihf.so cv2.so</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建软链接至虚拟环境</span></span><br><span class="line"><span class="built_in">cd</span> ~/.virtualenvs/<span class="built_in">cd</span>/lib/python3.x/site-packages/</span><br><span class="line">ln -s (cv2.so绝对位置) cv2.so</span><br></pre></td></tr></table></figure><h3 id="解决蛋疼的报错"><a href="#解决蛋疼的报错" class="headerlink" title="解决蛋疼的报错"></a>解决蛋疼的报错</h3><blockquote><p>/home/tellw/opencv-4.1.2/opencv_contrib-4.1.2/modules/xfeatures2d/src/boostdesc.cpp:654:20: fatal error: boostdesc_bgm.i: No such file or directory<br>#include “boostdesc_bgm.i”<br>^~~~~~~~~~~~~~~~~</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 反正就是少东西，要下载</span></span><br><span class="line"><span class="comment"># https://github.com/opencv/opencv_3rdparty 网址，里面不同分支有不同东西</span></span><br><span class="line"><span class="built_in">cd</span> ~/opencv-4.1.2/opencv_contrib-4.1.2/modules/xfeatures2d/src</span><br><span class="line">wget https://raw.githubusercontent.com/opencv/opencv_3rdparty/34e4206aef44d50e6bbcd0ab06354b52e7466d26/boostdesc_lbgm.i</span><br><span class="line">wget https://raw.githubusercontent.com/opencv/opencv_3rdparty/34e4206aef44d50e6bbcd0ab06354b52e7466d26/boostdesc_binboost_256.i</span><br><span class="line">wget https://raw.githubusercontent.com/opencv/opencv_3rdparty/34e4206aef44d50e6bbcd0ab06354b52e7466d26/boostdesc_binboost_128.i</span><br><span class="line">wget https://raw.githubusercontent.com/opencv/opencv_3rdparty/34e4206aef44d50e6bbcd0ab06354b52e7466d26/boostdesc_binboost_064.i</span><br><span class="line">wget https://raw.githubusercontent.com/opencv/opencv_3rdparty/34e4206aef44d50e6bbcd0ab06354b52e7466d26/boostdesc_bgm_hd.i</span><br><span class="line">wget https://raw.githubusercontent.com/opencv/opencv_3rdparty/34e4206aef44d50e6bbcd0ab06354b52e7466d26/boostdesc_bgm_bi.i</span><br><span class="line">wget https://raw.githubusercontent.com/opencv/opencv_3rdparty/34e4206aef44d50e6bbcd0ab06354b52e7466d26/boostdesc_bgm.i</span><br><span class="line">wget https://raw.githubusercontent.com/opencv/opencv_3rdparty/fccf7cd6a4b12079f73bbfb21745f9babcd4eb1d/vgg_generated_120.i</span><br><span class="line">wget https://raw.githubusercontent.com/opencv/opencv_3rdparty/fccf7cd6a4b12079f73bbfb21745f9babcd4eb1d/vgg_generated_64.i</span><br><span class="line">wget https://raw.githubusercontent.com/opencv/opencv_3rdparty/fccf7cd6a4b12079f73bbfb21745f9babcd4eb1d/vgg_generated_48.i</span><br><span class="line">wget https://raw.githubusercontent.com/opencv/opencv_3rdparty/fccf7cd6a4b12079f73bbfb21745f9babcd4eb1d/vgg_generated_80.i</span><br><span class="line">wget https://raw.githubusercontent.com/opencv/opencv_3rdparty/contrib_xfeatures2d_boostdesc_20161012/boostdesc_bgm_bi.i</span><br></pre></td></tr></table></figure><blockquote><p>/home/tellw/opencv-4.1.2/opencv_contrib-4.1.2/modules/xfeatures2d/test/test_features2d.cpp:51:10: fatal error: features2d/test/test_detectors_regression.impl.hpp: No such file or directory<br>#include “features2d/test/test_detectors_regression.impl.hpp”<br>^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p></blockquote><p>奇怪的报错， 解决方法也很奇怪。。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp -r ()/opencv-4.1.2/modules/features2d ()/opencv-4.1.2/build</span><br></pre></td></tr></table></figure><p>这俩问题解决完理论上就没问题了</p><p>我的版本为4.4.0y</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://tomcc7.github.io/1970/01/01/2020-10-19-pci/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="PlayerCC7"><meta itemprop="description" content="cc.log"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="CClog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/1970/01/01/2020-10-19-pci/" class="post-title-link" itemprop="url">PCI Passthrough</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：1970-01-01 08:00:00" itemprop="dateCreated datePublished" datetime="1970-01-01T08:00:00+08:00">1970-01-01</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-01-27 22:04:30" itemprop="dateModified" datetime="2021-01-27T22:04:30+08:00">2021-01-27</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Unfinished/" itemprop="url" rel="index"><span itemprop="name">Unfinished</span></a></span></span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="Archlinux-PCI显卡穿透"><a href="#Archlinux-PCI显卡穿透" class="headerlink" title="Archlinux PCI显卡穿透"></a>Archlinux PCI显卡穿透</h1><p>[toc]</p><h3 id="Enabling-IOMMU"><a href="#Enabling-IOMMU" class="headerlink" title="Enabling IOMMU"></a>Enabling IOMMU</h3><ul><li>For Intel CPUs (VT-d) set <code>intel_iommu=on</code></li><li>For AMD CPUs (AMD-Vi) set <code>amd_iommu=on</code></li></ul><p>After rebooting, check dmesg to confirm that IOMMU has been correctly enabled:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">dmesg | grep -i -e DMAR -e IOMMU</span><br><span class="line">[    0.000000] ACPI: DMAR 0x00000000BDCB1CB0 0000B8 (v01 INTEL  BDW      00000001 INTL 00000001)</span><br><span class="line">[    0.000000] Intel-IOMMU: enabled</span><br><span class="line">[    0.028879] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap c0000020660462 ecap f0101a</span><br><span class="line">[    0.028883] dmar: IOMMU 1: reg_base_addr fed91000 ver 1:0 cap d2008c20660462 ecap f010da</span><br><span class="line">[    0.028950] IOAPIC id 8 under DRHD base  0xfed91000 IOMMU 1</span><br><span class="line">[    0.536212] DMAR: No ATSR found</span><br><span class="line">[    0.536229] IOMMU 0 0xfed90000: using Queued invalidation</span><br><span class="line">[    0.536230] IOMMU 1 0xfed91000: using Queued invalidation</span><br><span class="line">[    0.536231] IOMMU: Setting RMRR:</span><br><span class="line">[    0.536241] IOMMU: Setting identity map for device 0000:00:02.0 [0xbf000000 - 0xcf1fffff]</span><br><span class="line">[    0.537490] IOMMU: Setting identity map for device 0000:00:14.0 [0xbdea8000 - 0xbdeb6fff]</span><br><span class="line">[    0.537512] IOMMU: Setting identity map for device 0000:00:1a.0 [0xbdea8000 - 0xbdeb6fff]</span><br><span class="line">[    0.537530] IOMMU: Setting identity map for device 0000:00:1d.0 [0xbdea8000 - 0xbdeb6fff]</span><br><span class="line">[    0.537543] IOMMU: Prepare 0-16MiB unity mapping for LPC</span><br><span class="line">[    0.537549] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff]</span><br><span class="line">[    2.182790] [drm] DMAR active, disabling use of stolen memory</span><br></pre></td></tr></table></figure><h3 id="Ensuring-that-the-groups-are-valid"><a href="#Ensuring-that-the-groups-are-valid" class="headerlink" title="Ensuring that the groups are valid"></a>Ensuring that the groups are valid</h3><p>The following script should allow you to see how your various PCI devices are mapped to IOMMU groups. If it does not return anything, you either have not enabled IOMMU support properly or your hardware does not support it.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">shopt -s nullglob</span><br><span class="line">for g in &#x2F;sys&#x2F;kernel&#x2F;iommu_groups&#x2F;*; do</span><br><span class="line">    echo &quot;IOMMU Group $&#123;g##*&#x2F;&#125;:&quot;</span><br><span class="line">    for d in $g&#x2F;devices&#x2F;*; do</span><br><span class="line">        echo -e &quot;\t$(lspci -nns $&#123;d##*&#x2F;&#125;)&quot;</span><br><span class="line">    done;</span><br><span class="line">done;</span><br></pre></td></tr></table></figure><p>An IOMMU group is the smallest set of physical devices that can be passed to a virtual machine. For instance, in the example above, both the GPU in 06:00.0 and its audio controller in 6:00.1 belong to IOMMU group 13 and can only be passed together. The frontal USB controller, however, has its own group (group 2) which is separate from both the USB expansion controller (group 10) and the rear USB controller (group 4), meaning that <a target="_blank" rel="noopener" href="https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF#USB_controller">any of them could be passed to a VM without affecting the others</a>.</p><p>Output on my computer:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">IOMMU Group 1:</span><br><span class="line">        00:01.0 PCI bridge [0604]: Intel Corporation Xeon E3-1200 v5&#x2F;E3-1500 v5&#x2F;6th Gen Core Processor PCIe Controller (x16) [8086:1901] (rev 07)</span><br><span class="line">        01:00.0 3D controller [0302]: NVIDIA Corporation TU117M [GeForce GTX 1650 Mobile &#x2F; Max-Q] [10de:1f91] (rev a1)</span><br></pre></td></tr></table></figure><h2 id="Isolating-the-GPU"><a href="#Isolating-the-GPU" class="headerlink" title="Isolating the GPU"></a>Isolating the GPU</h2><p>Find all device id in the group in the previous output.</p><h3 id="Binding-vfio-pci-via-device-ID"><a href="#Binding-vfio-pci-via-device-ID" class="headerlink" title="Binding vfio-pci via device ID"></a>Binding vfio-pci via device ID</h3><p>Two methods exist for providing the device IDs. Specifying them via <a target="_blank" rel="noopener" href="https://wiki.archlinux.org/index.php/Kernel_parameters">kernel parameters</a> has the advantage of being able to easily edit, remove, or undo any breaking changes via your boot loader:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vfio-pci.ids&#x3D;10de:13c2,10de:0fbb</span><br></pre></td></tr></table></figure><p>Alternatively(I chose this), the IDs may be added to a modprobe conf file. Since these conf files are embedded in the initramfs image, any changes require regenerating a new image each time:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;modprobe.d&#x2F;vfio.conf</span><br><span class="line">options vfio-pci ids&#x3D;10de:13c2,10de:0fbb</span><br></pre></td></tr></table></figure><h3 id="Loading-vfio-pci-early"><a href="#Loading-vfio-pci-early" class="headerlink" title="Loading vfio-pci early"></a>Loading vfio-pci early</h3><p>Since Arch’s <a target="_blank" rel="noopener" href="https://www.archlinux.org/packages/?name=linux">linux</a> has vfio-pci built as a module, we need to force it to load early before the graphics drivers have a chance to bind to the card. To ensure that, add <code>vfio_pci</code>, <code>vfio</code>, <code>vfio_iommu_type1</code>, and <code>vfio_virqfd</code> to <a target="_blank" rel="noopener" href="https://wiki.archlinux.org/index.php/Mkinitcpio">mkinitcpio</a>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;mkinitcpio.conf</span><br><span class="line">MODULES&#x3D;(... vfio_pci vfio vfio_iommu_type1 vfio_virqfd ...)</span><br></pre></td></tr></table></figure><p>Also, ensure that the modconf hook is included in the HOOKS list of <code>mkinitcpio.conf</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;mkinitcpio.conf</span><br><span class="line">HOOKS&#x3D;(... modconf ...)</span><br></pre></td></tr></table></figure><h3 id="Verifying-that-the-configuration-worked"><a href="#Verifying-that-the-configuration-worked" class="headerlink" title="Verifying that the configuration worked"></a>Verifying that the configuration worked</h3><p>Reboot and verify that vfio-pci has loaded properly and that it is now bound to the right devices.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ dmesg | grep -i vfio</span><br><span class="line">[    0.329224] VFIO - User Level meta-driver version: 0.3</span><br><span class="line">[    0.341372] vfio_pci: add [10de:13c2[ffff:ffff]] class 0x000000&#x2F;00000000</span><br><span class="line">[    0.354704] vfio_pci: add [10de:0fbb[ffff:ffff]] class 0x000000&#x2F;00000000</span><br><span class="line">[    2.061326] vfio-pci 0000:06:00.0: enabling device (0100 -&gt; 0103)</span><br></pre></td></tr></table></figure><p>It is not necessary for all devices (or even expected device) from <code>vfio.conf</code> to be in dmesg output. Sometimes a device does not appear in output at boot but actually is able to be visible and operatable in guest VM.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ lspci -nnk -d 10de:13c2</span><br><span class="line">06:00.0 VGA compatible controller: NVIDIA Corporation GM204 [GeForce GTX 970] [10de:13c2] (rev a1)</span><br><span class="line">	Kernel driver in use: vfio-pci</span><br><span class="line">	Kernel modules: nouveau nvidia</span><br><span class="line">$ lspci -nnk -d 10de:0fbb</span><br><span class="line">06:00.1 Audio device: NVIDIA Corporation GM204 High Definition Audio Controller [10de:0fbb] (rev a1)</span><br><span class="line">	Kernel driver in use: vfio-pci</span><br><span class="line">	Kernel modules: snd_hda_intel</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://tomcc7.github.io/1970/01/01/2020-10-19-raspberrypi/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="PlayerCC7"><meta itemprop="description" content="cc.log"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="CClog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/1970/01/01/2020-10-19-raspberrypi/" class="post-title-link" itemprop="url">RaspberryPi Configuration</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：1970-01-01 08:00:00" itemprop="dateCreated datePublished" datetime="1970-01-01T08:00:00+08:00">1970-01-01</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-12-17 13:17:06" itemprop="dateModified" datetime="2020-12-17T13:17:06+08:00">2020-12-17</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/configurations/" itemprop="url" rel="index"><span itemprop="name">configurations</span></a></span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>[toc]</p><h1 id="系统"><a href="#系统" class="headerlink" title="系统"></a>系统</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​ 这个教程利用树莓派作为主机并使用nextcloud建立一个私有云盘服务，利用寝室的<strong>公网ip</strong>可以很方便地从外部访问云盘。如果你正好有一块闲置的固态硬盘不妨做一个试试。</p><h3 id="Nextcloud"><a href="#Nextcloud" class="headerlink" title="Nextcloud"></a>Nextcloud</h3><blockquote><p>​ <a target="_blank" rel="noopener" href="https://nextcloud.com/"><strong>Nextcloud</strong></a>是一套用于创建<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E7%A1%AC%E7%9B%98">网络硬盘</a>的<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%B8%BB%E5%BE%9E%E5%BC%8F%E6%9E%B6%E6%A7%8B">客户端－服务器软件</a>。其功能与<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Dropbox">Dropbox</a>相近，但Nextcloud是<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%87%AA%E7%94%B1%E5%8F%8A%E5%BC%80%E6%94%BE%E6%BA%90%E4%BB%A3%E7%A0%81%E8%BD%AF%E4%BB%B6">自由及开放源代码软件</a>，每个人都可以在私人服务器上安装并运行它。</p><p>​ 与Dropbox等专有服务相比，Nextcloud的开放架构让用户可以利用应用程序的方式在服务器上新增额外的功能，并让用户可以完全掌控自己的数据。</p></blockquote><p>​ 以上内容摘自维基百科，与网络文件系统相比，nextcloud更像一个百度网盘，你可以从几乎任何平台访问你的文件。</p><p><img src="https://www.player7.cc:44343/uploads/big/bf48e2258b4300af73e48522a98fcbab.png" alt="nextcloud"></p><h2 id="材料准备"><a href="#材料准备" class="headerlink" title="材料准备"></a>材料准备</h2><ul><li>树莓派-作为主机，建议使用4B+（有<strong>千兆网口</strong>）的1GB版本</li><li>microsd卡-用于存放系统</li><li>移动硬盘-用于存放数据</li><li>网线-最好使用有线网连接，没有用wifi也可以</li></ul><h2 id="树莓派启动-amp-配置"><a href="#树莓派启动-amp-配置" class="headerlink" title="树莓派启动&amp;配置"></a>树莓派启动&amp;配置</h2><h3 id="刷系统"><a href="#刷系统" class="headerlink" title="刷系统"></a>刷系统</h3><p>​ 这里使用系统raspbian buster的桌面版本。由于官网的镜像下载速度非常慢，我已将镜像上传到<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1lBbbe2MyQIu2Lpu8VcKH5A">百度网盘</a>(提取码：g3it)。</p><p>​ 烧写器可以使用<a target="_blank" rel="noopener" href="https://www.balena.io/etcher/">etcher</a>，一款免费的全平台烧写器。下载好镜像和烧写器后就可以开始烧写了，烧写过程会比较慢。</p><p><img src="https://www.player7.cc:44343/uploads/big/49979035be9e018aad0408e22dc5cde7.png" alt="etcher"></p><p>​ 烧写完成后我们会发现sd卡被分成了两个区，其中boot区会在启动时被读取，而rootfs区存放了系统文件。</p><p><img src="https://www.player7.cc:44343/uploads/big/205c86eacc7053f91975a3ca0454cbd8.png" alt="分区"></p><h3 id="启动-amp-ssh连接"><a href="#启动-amp-ssh连接" class="headerlink" title="启动&amp;ssh连接"></a>启动&amp;ssh连接</h3><h4 id="启动ssh"><a href="#启动ssh" class="headerlink" title="启动ssh"></a>启动ssh</h4><p>​ 启动ssh非常简单，在boot分区中创建一个名为SSH的空文件即可。提供一种方法：新建一个文本，重命名为SSH（无后缀。</p><h4 id="配置wifi"><a href="#配置wifi" class="headerlink" title="配置wifi"></a>配置wifi</h4><p>​ <strong>如果插网线启动可以直接跳过这步。</strong></p><p>​ 在boot目录下创建一个名为wpa_supplicant.conf的文件，填入以下信息：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">country=GB</span><br><span class="line">ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev</span><br><span class="line">update_config=1</span><br><span class="line"></span><br><span class="line">network=&#123;</span><br><span class="line">	ssid=&quot;wifi名&quot;</span><br><span class="line">	psk=&quot;密码&quot;</span><br><span class="line">	priority=正整数，越大优先级越高</span><br><span class="line">&#125;</span><br><span class="line">network=&#123;</span><br><span class="line">	ssid=&quot;更多wifi名&quot;</span><br><span class="line">	psk=&quot;密码&quot;</span><br><span class="line">	priority=正整数，越大优先级越高</span><br><span class="line">&#125;</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>​ 需要注意的是wifi名和密码都需要使用双引号包起来。配置完wifi后将microsd卡正面朝上插入树莓派，就可以启动了，启动后我们放入的两个文件将被自动读取后删除。</p><h3 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h3><p>​ 要进行连接首先要获取你树莓派的ip地址，最简单的方法是登录路由器的管理页面查看。获取ip地址后就可以通过ssh登录树莓派了，这里使用一款ssh工具<a target="_blank" rel="noopener" href="https://www.putty.org/">putty</a>进行连接。</p><p>​ <img src="https://www.player7.cc:44343/uploads/big/b5ef01abf47b5adb10cfcc9b4cf9b944.png" alt="putty"></p><p>​ 在ip地址栏输入树莓派的ip（上图为我的），接下来点<em>Open</em>就能够连接了。连接成功后如下图所示：</p><p><img src="https://www.player7.cc:44343/uploads/big/c827899853e70782d325f628cac6d469.png" alt="puttylogin"></p><p>​ 树莓派的初始用户名为’pi’,密码为’raspberry’。输入后看到以下界面就代表登录成功啦。</p><p><img src="https://www.player7.cc:44343/uploads/big/121ee664e09d363ce80479a9b171edd8.png" alt="puttylogind"></p><h3 id="配置树莓派"><a href="#配置树莓派" class="headerlink" title="配置树莓派"></a>配置树莓派</h3><h4 id="连vpn"><a href="#连vpn" class="headerlink" title="连vpn"></a>连vpn</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> http_proxy=http://192.168.0.109:12333 &amp;&amp; <span class="built_in">export</span> https_proxy=http://192.168.0.109:12333</span><br></pre></td></tr></table></figure><h4 id="系统设置"><a href="#系统设置" class="headerlink" title="系统设置"></a>系统设置</h4><p>​ 在命令行中输入<code>sudo raspi-config</code>可进入raspbian系统的设置界面：</p><p><img src="https://www.player7.cc:44343/uploads/big/3055fa355b45a15ffb6bd570e8b15a76.png" alt="raspi-config"></p><p>​ 进入设置界面后，我们从上往下进行设置更改</p><ol><li>在<code>Change User Password</code>中修改登录密码</li><li>在<code>Localisation Options</code>中选择<code>Change Timezone</code>后选择<code>Shanghai</code></li><li>在<code>Advanced Options</code>中选择<code>Expand Filesystem</code>将系统分区扩展至整个sd卡</li><li>最后选择<code>Finish</code>重启树莓派并应用设置</li></ol><h4 id="换源-amp-更新软件"><a href="#换源-amp-更新软件" class="headerlink" title="换源&amp;更新软件"></a>换源&amp;更新软件</h4><p>​ 由于接下来会需要下载许多软件，修改软件源会使这一过程更加迅速。</p><p>​ 这里使用<a target="_blank" rel="noopener" href="https://mirror.tuna.tsinghua.edu.cn/help/raspbian/">清华镜像站</a>提供的raspbian镜像（wsm交大没有）。</p><p>​ 键入命令<code>sudo nano /etc/apt/sources.list</code>，删除原文件所有内容，用以下内容取代：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">deb http:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;raspbian&#x2F;raspbian&#x2F; buster main non-free contrib</span><br><span class="line">deb-src http:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;raspbian&#x2F;raspbian&#x2F; buster main non-free contrib</span><br></pre></td></tr></table></figure><p>​ 接下来按ctrl+O后按回车保存文件，按ctrl+X退出。</p><p>​ 同样的，输入<code>sudo nano /etc/apt/sources.list.d/raspi.list</code>，删除原文件所有内容，用以下内容取代：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deb http:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;raspberrypi&#x2F; buster main ui</span><br></pre></td></tr></table></figure><p>​ 同样保存退出后输入<code>sudo apt update</code>更新软件源，换源部分完成。</p><p>​ 最后，输入<code>sudo apt upgrade</code>更新一下软件，这一步不做也可以。</p><h4 id="PIP换源"><a href="#PIP换源" class="headerlink" title="PIP换源"></a>PIP换源</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mkdir .pip</span><br><span class="line">vim .pip/pip.conf</span><br><span class="line"><span class="comment">#复制以下</span></span><br><span class="line">[global]</span><br><span class="line">timeout = 10</span><br><span class="line">index-url =  http://mirrors.aliyun.com/pypi/simple/</span><br><span class="line">extra-index-url= http://pypi.douban.com/simple/</span><br><span class="line">[install]</span><br><span class="line">trusted-host=</span><br><span class="line">    mirrors.aliyun.com</span><br><span class="line">    pypi.douban.com</span><br></pre></td></tr></table></figure><h4 id="设置ssh密钥登录"><a href="#设置ssh密钥登录" class="headerlink" title="设置ssh密钥登录"></a>设置ssh密钥登录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录树梅派</span></span><br><span class="line">mkdir .ssh</span><br><span class="line">vim .ssh/authorized_keys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制公钥 #</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置权限</span></span><br><span class="line">sudo chmod -R 700 ~/.ssh</span><br><span class="line">chmod 600 ~/.ssh/authorized_keys </span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改sshd设置</span></span><br><span class="line">sudo vim /etc/ssh/sshd_config</span><br><span class="line"><span class="comment">###</span></span><br><span class="line">RSAAuthentication yes</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line">PermitRootLogin no</span><br><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment"># PasswordAuthentication no #禁用密码登录</span></span><br><span class="line">sudo service sshd restart <span class="comment">#重启服务</span></span><br></pre></td></tr></table></figure><h4 id="开机自启服务配置-jupyter为例"><a href="#开机自启服务配置-jupyter为例" class="headerlink" title="开机自启服务配置-jupyter为例"></a>开机自启服务配置-jupyter为例</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/systemd/system/jupyter.service</span><br><span class="line"><span class="comment"># 复制以下</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Jupyter Notebook</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">PIDFile=/run/jupyter.pid </span><br><span class="line"><span class="comment">#这里在/run/目录下没有jupyter.pid,搜索相关信息发现,这个是进程产生之后出现的,虽然在启动前没有,但是可以使用.</span></span><br><span class="line">ExecStart=/home/pi/.<span class="built_in">local</span>/bin/jupyter-notebook --config=/home/pi/.jupyter/jupyter_notebook_config.py </span><br><span class="line"><span class="comment">#ExecStart 是执行文件 --config是配置文件,之前我已经配置过jupyter_notebook_config.py,有的教程是配置.json文件(没试过)</span></span><br><span class="line">User=pi</span><br><span class="line">Group=pi</span><br><span class="line">WorkingDirectory=/home/pi/Desktop/jupyter_project </span><br><span class="line"><span class="comment">#自己设置的工作目录,需要同时在jupyter_notebook_config.py中设置c.NotebookApp.notebook_dir = &#x27;/home/pi/Desktop/jupyter_project&#x27; 配置自己的工作目录</span></span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=10</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行以下命令</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> jupyter.service</span><br><span class="line">sudo service jupyter start</span><br></pre></td></tr></table></figure><h1 id="软件"><a href="#软件" class="headerlink" title="软件"></a>软件</h1><h3 id="TeamViewer"><a href="#TeamViewer" class="headerlink" title="TeamViewer"></a>TeamViewer</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mkdir Downloads</span><br><span class="line"><span class="built_in">cd</span> Downloads</span><br><span class="line">wget https://download.teamviewer.com/download/linux/teamviewer-host_armhf.deb</span><br><span class="line">sudo dpkg -i teamviewer-host_armhf.deb</span><br><span class="line">sudo apt install -fy</span><br><span class="line">sudo dpkg -i teamviewer-host_armhf.deb</span><br><span class="line">sudo reboot <span class="comment">#重启电脑</span></span><br><span class="line">teamviewer setup</span><br><span class="line">teamviewer passwd=... <span class="comment">#设置密码才能连接</span></span><br><span class="line">teamviewer info <span class="comment">#查看uid</span></span><br></pre></td></tr></table></figure><blockquote><p>命令行下无法启动:<a target="_blank" rel="noopener" href="https://blog.csdn.net/cocoaqin/article/details/100938804">https://blog.csdn.net/cocoaqin/article/details/100938804</a></p></blockquote><h1 id="树莓派GPIO"><a href="#树莓派GPIO" class="headerlink" title="树莓派GPIO"></a>树莓派GPIO</h1><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo raspi-config</span><br><span class="line"><span class="comment">#开启 remote-gpio, spi, i2c</span></span><br><span class="line"><span class="comment"># reboot</span></span><br><span class="line"><span class="comment">## 下载wiringpi</span></span><br><span class="line">wget https://project-downloads.drogon.net/wiringpi-latest.deb <span class="comment">#下载</span></span><br><span class="line">sudo dpkg -i wiringpi-latest.deb <span class="comment">#安装</span></span><br></pre></td></tr></table></figure><h2 id="WiringPi"><a href="#WiringPi" class="headerlink" title="WiringPi"></a>WiringPi</h2><blockquote><p><a target="_blank" rel="noopener" href="http://wiringpi.com/reference/">http://wiringpi.com/reference/</a></p></blockquote></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://tomcc7.github.io/1970/01/01/2020-11-04-stm32/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="PlayerCC7"><meta itemprop="description" content="cc.log"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="CClog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/1970/01/01/2020-11-04-stm32/" class="post-title-link" itemprop="url">STM32开发环境搭建-Linux篇</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：1970-01-01 08:00:00" itemprop="dateCreated datePublished" datetime="1970-01-01T08:00:00+08:00">1970-01-01</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-01-27 22:09:56" itemprop="dateModified" datetime="2021-01-27T22:09:56+08:00">2021-01-27</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/tutorials/" itemprop="url" rel="index"><span itemprop="name">tutorials</span></a></span></span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="配置CLion用于STM32开发-Linux篇"><a href="#配置CLion用于STM32开发-Linux篇" class="headerlink" title="配置CLion用于STM32开发-Linux篇"></a>配置CLion用于STM32开发-Linux篇</h1><blockquote><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/145801160">https://zhuanlan.zhihu.com/p/145801160</a></p></blockquote><p>我的系统：<code>5.8.16-2-MANJARO</code></p><h2 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h2><h3 id="CLion"><a href="#CLion" class="headerlink" title="CLion"></a>CLion</h3><p>装呗</p><h3 id="CubeMX"><a href="#CubeMX" class="headerlink" title="CubeMX"></a>CubeMX</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置java</span></span><br><span class="line">sudo pacman -S jre-openjdk</span><br><span class="line"><span class="comment"># 下载cubemx 安装</span></span><br><span class="line"><span class="comment"># https://www.st.com/en/development-tools/stm32cubemx.html#get-software</span></span><br></pre></td></tr></table></figure><h3 id="交叉编译器-gnu-arm-none-eabi"><a href="#交叉编译器-gnu-arm-none-eabi" class="headerlink" title="交叉编译器 gnu-arm-none-eabi"></a>交叉编译器 gnu-arm-none-eabi</h3><blockquote><p><a target="_blank" rel="noopener" href="https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm/downloads">https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm/downloads</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解压下来放到要一个目录</span></span><br><span class="line"><span class="comment"># 添加环境变量</span></span><br><span class="line">sudo vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;<span class="variable">$&#123;PATH&#125;</span>:/path/to/your/file/bin&quot;</span></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">arm-none-eabi-gcc -v</span><br></pre></td></tr></table></figure><h3 id="ST-link-驱动"><a href="#ST-link-驱动" class="headerlink" title="ST-link 驱动"></a>ST-link 驱动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/texane/stlink.git</span><br><span class="line"><span class="built_in">cd</span> stlink/</span><br><span class="line">./autogen.sh</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure><h3 id="Openocd"><a href="#Openocd" class="headerlink" title="Openocd"></a>Openocd</h3><p>包管理器里应该有</p><h2 id="CLion配置"><a href="#CLion配置" class="headerlink" title="CLion配置"></a>CLion配置</h2><h3 id="Toolchains-amp-cmake"><a href="#Toolchains-amp-cmake" class="headerlink" title="Toolchains &amp; cmake"></a>Toolchains &amp; cmake</h3><p>打开<code>File-Settings-Build,Execution,Deployment</code>选项卡，在<code>Toolchains</code>下面添加一个stm32环境：</p><p><img src="https://www.player7.cc:44343/uploads/big/69e7666f5a1354283fd475312aff9850.png" alt="image-20201104172457131"></p><p>检查cmake中的toolchain：</p><p><img src="https://www.player7.cc:44343/uploads/big/7c05ebf65f81f4f160339ef7d31b4459.png" alt="image-20201104174515522"></p><h3 id="创建烧录配置"><a href="#创建烧录配置" class="headerlink" title="创建烧录配置"></a>创建烧录配置</h3><p><img src="https://www.player7.cc:44343/uploads/big/4219ee2080acf835e1f327baa7474492.png" alt="image-20201104174637041"></p><p>配置如下：</p><p><img src="https://www.player7.cc:44343/uploads/big/510b7b188b1dd4eda4186a16d8a73eeb.png" alt="image-20201104174832861"></p><p>接下来点击<code>run</code>就可以烧录了。</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://tomcc7.github.io/1970/01/01/2020-12-17-lychee/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="PlayerCC7"><meta itemprop="description" content="cc.log"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="CClog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/1970/01/01/2020-12-17-lychee/" class="post-title-link" itemprop="url">搭建lychee图床</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：1970-01-01 08:00:00" itemprop="dateCreated datePublished" datetime="1970-01-01T08:00:00+08:00">1970-01-01</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-12-17 13:06:57" itemprop="dateModified" datetime="2020-12-17T13:06:57+08:00">2020-12-17</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/configurations/" itemprop="url" rel="index"><span itemprop="name">configurations</span></a></span></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="搭建lychee图床"><a href="#搭建lychee图床" class="headerlink" title="搭建lychee图床"></a>搭建lychee图床</h2><blockquote><p><a target="_blank" rel="noopener" href="https://github.com/electerious/Lychee">https://github.com/electerious/Lychee</a></p></blockquote><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/electerious/Lychee</span><br><span class="line"><span class="comment"># 放在www目录</span></span><br><span class="line">chmod -R 750 uploads/ data/</span><br></pre></td></tr></table></figure><h3 id="Apache配置"><a href="#Apache配置" class="headerlink" title="Apache配置"></a>Apache配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost *:44343&gt;</span><br><span class="line">   ServerName player7.cc</span><br><span class="line">   ServerAdmin webmaster@player7.cc</span><br><span class="line">   DocumentRoot &#x2F;var&#x2F;www&#x2F;lychee</span><br><span class="line"></span><br><span class="line">   &lt;Directory &#x2F;var&#x2F;www&#x2F;lychee&gt;</span><br><span class="line">       AllowOverride All</span><br><span class="line">   &lt;&#x2F;Directory&gt;</span><br><span class="line">   ErrorLog $&#123;APACHE_LOG_DIR&#125;&#x2F;error_lychee.log</span><br><span class="line">   CustomLog $&#123;APACHE_LOG_DIR&#125;&#x2F;access_lychee.log co</span><br><span class="line">mbined</span><br><span class="line">   SSLEngine on</span><br><span class="line">   SSLCertificateFile &#x2F;etc&#x2F;ssl&#x2F;player7_cc.crt</span><br><span class="line">   SSLCertificateKeyFile &#x2F;etc&#x2F;ssl&#x2F;private&#x2F;ccloud.ke</span><br><span class="line">y</span><br><span class="line">   SSLCertificateChainFile &#x2F;etc&#x2F;ssl&#x2F;player7_cc.ca-b</span><br><span class="line">undle</span><br><span class="line">&lt;&#x2F;VirtualHost&gt;</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://tomcc7.github.io/1970/01/01/2020-12-23%E5%AE%9E%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="PlayerCC7"><meta itemprop="description" content="cc.log"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="CClog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/1970/01/01/2020-12-23%E5%AE%9E%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">实习笔记</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：1970-01-01 08:00:00" itemprop="dateCreated datePublished" datetime="1970-01-01T08:00:00+08:00">1970-01-01</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-01-27 22:14:22" itemprop="dateModified" datetime="2021-01-27T22:14:22+08:00">2021-01-27</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/references/" itemprop="url" rel="index"><span itemprop="name">references</span></a></span></span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="实习笔记"><a href="#实习笔记" class="headerlink" title="实习笔记"></a>实习笔记</h1><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><h3 id="交叉编译"><a href="#交叉编译" class="headerlink" title="交叉编译"></a>交叉编译</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S lib32-glibc lib32-gcc-libs</span><br></pre></td></tr></table></figure><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p><code>CMake: The C Compiler is not able to compile a simple test program</code> :add <code>--sysroot</code>.</p><h2 id="FFMPEG"><a href="#FFMPEG" class="headerlink" title="FFMPEG"></a>FFMPEG</h2><h3 id="摄像头相关"><a href="#摄像头相关" class="headerlink" title="摄像头相关"></a>摄像头相关</h3><ul><li><p><code>av_packet_unref(AVPacket*)</code> 如果不使用，则<code>readframe</code>将会一直得到相同结果</p></li><li><blockquote><p>what should be used instead of <code>av_register_all()</code>?</p></blockquote><p>Nothing. You can just omit this function call in ffmpeg 4.0 and later.</p></li></ul></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><nav class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a></nav><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">PlayerCC7</span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动</div></div></footer><script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>